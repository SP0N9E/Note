# 计算机视觉复习

[TOC]



### Chapter1-Introduction

#### 什么是计算机视觉

​	人类感知外部世界主要是通过视觉、触觉、听觉和嗅觉等感觉器官，其中**约70%-80%**的信息是由视觉获得的

​	**计算机视觉：**an interdisciplinary scientific field that deals with how computers can be made to gain high-level understanding from digital images or videos. From the perspective of engineering, it seeks to automate tasks that the human visual system can do. -- Wikipedia 

​	**中心任务：**对图像进行理解（形状、位置、运动、类别）



#### 计算机视觉的五大研究内容

1. **低层视觉(low level/early)** 对输入的原始图像进行处理。常借用图像处理技术和算法，如图像滤波、图像增强、边缘检测、纹理检测、运动检测，以便从图像中提取角点、边缘、线条、边界、色彩、纹理、运动等关于场景的基本特征。
2. **中层视觉(middle level)** 恢复场景的深度、表面法线方向、轮廓等有关场景的**2.5维信息**，实现的途径有立体视觉(stereo vision)、测距成像(rangefinder)、从X恢复形状(shape from X, X=明暗、纹理、运动)。系统标定、系统成像模拟等研究内容一般也是在这个层次上进行的。**分割、拟合等**
3. **高层视觉(high level)** 在原始输入图像、图像基本特征、2.5维的基础上，恢复物体的完整三维图，建立物体三位描述，识别物体并确定物体的位置和方向等信息。
4. **输入设备(input device)** 包括成像设备和数字化设备，成像设备是指通过光学摄像机或红外、激光、超声、X射线对周围场景或物体进行探测成像，得到关于场景或物体的二维或三维数字化图像。
5. **体系结构(system architecture)** 在高度抽象的层次上， 根据系统模型而不是根据实现设计的具体例子来研究系统的结构． 为了说明这一点， 可以考虑建筑设计中某一时期的建筑风格（ 如清朝时期） 和根据这一风格设计出来的具体建筑之间的区别． 体系结构研究涉及一系列相关的课题：并行结构、 分层结构、 信息流结构、 拓扑结构以及从设计到实现的途径等等  



#### Marr视觉计算理论

1. 信息处理分析的三个层次

   |                            计算层                            |                         表示和算法层                         |            实现层            |
   | :----------------------------------------------------------: | :----------------------------------------------------------: | :--------------------------: |
   | 计算的目的是什么？<br>为什么这一计算是合适的？<br>执行计算的策略是什么？ | 如何实现这个计算？<br>输入输出的表示是什么<br>表示与表示之间的变换是什么 | 在物理上如何实现这些表示算法 |

   

2. 视觉表示框架的三个层次

   **第一阶段(Primary Sketch):** 将输入的原始图像进行处理，抽取图像中诸如角点、边缘、纹理、线条、边界等基本特征，这些特征的集合称为基元图。

   **第二阶段(2.5D Sketch): **指在以观测者为中心的坐标系中，由输入图像和基元图恢复场景可见部分的深度、法线方向、轮廓等，这些信息包含了深度信息，但不是真正的物体三维表示，因此称为二维半图

   **第三阶段(3D Model): **在一物体为中心的坐标系中，由输入图像、基元图、二维半图来恢复、表示和识别三维物体



##### 格式塔理论 Gestalt theory

1. **Law of Proximity(接近原理)：**人们自然而然的对靠近的事物进行分类
2. **Law of Similarity(相似原理)：**人们在观察对象时容易把相似的物体分为一组
3. **Law of Common Fate(共同命运原理)：**对象容易被视为行进在光滑路径上的线条
4. **Law of Symmetry(相似原理)：**人们观察对象时容易将对象视为对称的且围绕一个中心
5. **Law of Continuity(连续原理)：**对象的元素容易群聚在一起，且能形成整体
6. **Law of Closure(闭合原理)：**人们在观察诸如形状、信封、照片时自动补全他们

---



### Chapter2-Binary 二值图像

#### 几何特性

1. **面积(零阶矩)**
   $$
   A=\sum_{i=0}^{n-1}\sum_{j=0}^{m-1}B[i,j]
   $$

2. **区域中心(一阶矩)**
   $$
   \bar x = \frac{\sum_{i=0}^{n-1}\sum_{j=0}^{m-1}jB[i,j]}{A} \\
   \bar y = - \frac{\sum_{i=0}^{n-1}\sum_{j=0}^{m-1}iB[i,j]}{A} \\
   $$
   
3. **方向**

   某些形状（圆）是没有方向的；假定物体是长形的，长轴方向为物体的方向

   求方向$\rightarrow$最小化问题：
   $$
   \chi^2 = \sum_{i=0}^{n-1}\sum_{j=0}^{m-1} r_{ij}^2 B[i,j],r_{ij} 是点[i,j]到直线的距离\\
   直线方程\quad \rho = x \cos{\theta} + y \sin{\theta} \\
   距离\quad r^2 = (x \cos{\theta} + y \sin{\theta} - \rho)^2
   $$
   
4. **伸长率**
   $$
   E = \frac{\chi_{max}}{\chi_{min}}
   $$
   
5. **密集度**
   $$
   C=\frac{A}{p^2}\\
   其中p：周长，A：面积
   $$
   给定周长，密集度越高，围成的面积越大

   圆>正方形>长方形

6. **形态比**

   区域的最小外接矩形的长与宽之比

7. **欧拉数(亏格数，genus)**

   **连通分量数**减去**洞数**
   $$
   E = C - H
   $$
   平稳、旋转和比例不变

   

![1](.\img\1.jpg)



#### 投影计算

1. **定义：**给定一条直线，用垂直该直线的一簇等间距直线将一幅二值图像分割成若干条，每一条**内象素值为1的象素**的数量  

2. **水平投影：**计算每一列像素为1的个数

3. **垂直投影：**计算每一行像素为1的个数

4. **对角线投影：**从左下到右上，计算每一个对角线像素为1的个数

   仿射变换$\Rightarrow$将右上角像素映射成对角线投影的第一个位置，左下角对应最后一个对角线投影标号对应关系 ，其中[i.j]为原像素坐标，图像大小为n*m  

![2](.\img\2.jpg)



#### 连通区域

1. **领点概念**

   ![3](.\img\3.jpg)

2. **连通性**

   <img src=".\img\4.jpg" alt="4" style="zoom:80%;" />

   

3. **连通分量定义：**连通像素的集合

4. **连通分量标记算法(递归算法)：** 

   - 扫描图像，找到没有标记的一个前景点(即像素值为1)，分配标记L

   - 递归分配标记L给该点的邻点

   - 如果不存在没标记的点，停止

   - 返回第一步

5. **连通分量标记算法(序贯算法)：**

   （1）从左到右、从上到下扫描图像

   （2）如果像素值为1，则（分四种情况）

   - 如果上面点和左面点有且仅有一个标记，则复制这一标记  
   - 如果两点有相同标记，复制这一标记  
   - 如果两点有不同标记，则复制上点的标记且将两个标记输入等价表中作为等价标记  
   - 否则给这一个象素点分配一新的标记并将这一标记输入等价表  

   （3）如果需要考虑更多点，则返回(2)  

   （4）在等价表的每一等价集中找到最低的标记  

   （5）扫描图像，用等价表中的最低标记取代每一标记  

6. **区域边界跟踪算法：**

   **符号定义：**                                  $c:当前点（在边界上）\quad b:当前点的邻域点(不在边界上)$

   **过程：**

   - 左 $\rightarrow$ 右，上 $\rightarrow$ 下，扫描图像，求区域S的起始点  $s(k) = (x(k),y(k)),k=0$
   - 用c表示当前边界上被跟踪的象素点，置$c=s(k)$，记c的**左邻点**为$b, b\in \bar S$
   - 按逆时针方向记从b开始的c的8个8邻点分别为$n_1,n_2,…,n_8,k=k+1$
   - 从b开始，沿逆时针方向找到第一个$n_i\in S$
   - 置$c=s(k)=n_i,\ b=n_{i-1}$
   - 重复步骤(3),(4),(5)，直到$s(k)=s(0) $ 

----



### Chapter3-Edge 边缘



#### 边缘检测的基本思想

> An edge is a place of rapid change in the image intensity function  

先确定图像中的边缘像素，然后把这些像素连接在一起就构成所需的区域边界。

函数导数反映图像灰度变化的显著程度，一阶导数的**局部最大值(Local maxima)**，或二阶导数的**过零点(Zero-crossing)**



#### 基于一阶导数的边缘检测

- **梯度**

  - 定义：是图像对应二位函数的一阶导数![5](.\img\5.jpg)

  - 幅值：$|G(x,y)|=\sqrt{G_x^2 + G_y^2} = |G_x|+|G_y| \approx max(|G_x|,|G_y|)$
  - 方向：$a(x,y) = \arctan(G_y/G_x)$

- **常用模板**

  - 差分近似：![6](.\img\6.jpg)
  - Roberts交叉算子：![7](.\img\7.jpg)
  - Sobel算子：![8](.\img\8.jpg)
  - Prewitt算子：运算速度较快![9](.\img\9.jpg)
  - 均值差分：<img src=".\img\10.jpg" alt="10" style="zoom:50%;" />



#### 基于二阶导数的边缘检测

- **拉普拉斯算子**

  - 是二阶导数的二维等效式<img src=".\img\11.jpg" alt="11" style="zoom: 67%;" />

  - 等效模板

    ![12](.\img\12.jpg)

- **LoG算子**

  - LoG = Laplacian of Gaussian **高斯滤波+拉普拉斯边缘检测**

  - 基本特征：

    平滑滤波器是高斯滤波器

    采用拉普拉斯算子计算二阶导数  

    边缘检测判据是二阶导数零交叉点并对应一阶导数的较大峰值  

    使用线性内插方法在子像素分辨率水平上估计边缘的位置  

  - 两种等效算法
    （1）图像与高斯函数卷积，再求卷积的拉普拉斯微分

    （2）求高斯函数的拉普拉斯微分，再与图像卷积

  - 为什么加上G：平滑去噪和边缘检测是一对矛盾，应用高斯函数的一阶导数，在二者之间获得最佳平衡
  - 推导过程：

<img src=".\img\14.jpg" alt="14" style="zoom:50%;" />

#### Canny边缘检测

- **算法步骤：**

  - 高斯滤波器平滑图像

  - 用**一阶偏导有限差分**计算**梯度幅值和方向**

    $G_x[i,j]\approx(S[i,j+1]-S[i,j]+S[i+1,j+1]-S[i+1,j])/2$

    $G_y[i,j]\approx(S[i,j]-S[i+1,j]+S[i,j+1]-S[i+1,j+1])/2$

    $M[i,j] = \sqrt {G_x[i,j]^2 + G_y[i,j]^2}$

    $\theta[i,j] = \arctan(G_y[i,j]/G_x[i,j])$

  - 对梯度幅值进行非极大值抑制

    方向角离散化（360°分为8个扇区，对称扇区标号相同）  

    在离散后的梯度方向（$±45^°,±90^°,±135^°,0^°,180^°$ ）上找到幅值最大的点保留，其余点置零  

  - 用**双阈值算法**检测和连接边缘

    取高低阈值T1,T2） ——阈值太低->假边缘；阈值太高->轮廓丢失  

    得到高阈值图$N[i,j]>T_2$ ，低阈值图 $N[i,j]<T_1$ 

    连接高阈值边缘；出现断点时在低阈值边缘图中的**八邻点域**搜索边缘点  

- **双阈值的意义和效果：**

  - 高阈值是将要提取轮廓的物体与背景区分开—**阈值太高：轮廓丢失**
  - 低阈值用来平滑边缘的轮廓—**阈值太低：假边缘**
  - 两个阈值区分**强边界**、**若边界**，更加有效



---





### Chapter4-Feature 局部特征

#### Harris角点检测

- **原理**

  - 使用一个固定窗口在图像上进行任意方向上的滑动

  - 比较滑动前与滑动后窗口中的像素灰度上的变化程度

  - 如果存在任意方向上的滑动，都有着较大灰度变化，那么可以认为该窗口中存在角点

    Flat:窗口内图像基本无变化

    Edge:沿Edge平移窗口时，窗口内图像无变化  

    Corner:**各方向平移**时都有较大变化  

- **公式推导**

  - **自相关函数**——描述窗平移后的相似度$E(u,v)=\sum_{x,y} w(x,y)[I(x+u,y+v)-I(x,y)]^2$

    二元函数的一阶泰勒展开近似为$f(x+u,y+v)\approx f(x,y)+uf_x(x,y)+vf_y(x,y) $

    ![15](.\img\15.jpg)

  - **推导过程**

    ![16](.\img\16.jpg)

    <img src=".\img\17.jpg" alt="17" style="zoom:80%;" />

  - **$\lambda_{max}、\lambda_{min}$的含义**

    $\lambda_{max}$代表椭圆的长轴，$\lambda_{min}$代表椭圆的短轴

    通过$\lambda_{max}、\lambda_{min}$判断角点：

    <img src=".\img\18.jpg" alt="18" style="zoom: 67%;" />

    通过响应值函数R判断：

  $$
  R=\det M- k(trace M)^2\\
  \det M = \lambda_1\lambda_2\\
  trace M = \lambda_1+\lambda_2
  $$

  

  <img src=".\img\19.jpg" alt="19" style="zoom:67%;" />

  - **算法过程**

    计算图像R值，并用合适阈值进行二值化

    找到R值的极值点

  - **算法特点**

    旋转不变性：椭圆可以旋转但是形状还是一样的

    平移不变性

    仿射强度变化的部分不变性：图像有偏置（$I\rightarrow I+b$ 或 $I\rightarrow aI$）时极值点不变  

    **问题：**无尺度不变性 $\rightarrow$  Solution: Harris-Laplace / SIFT  

    <img src=".\img\20.jpg" alt="20" style="zoom:50%;" />

    一幅图像的尺度空间可被定义为**原图像与可变尺度的高斯核$G(x,y,\sigma)$ 卷积**  



#### SIFT描述子的计算

- **计算基本步骤**
  1. 构建尺度空间，建立图像金字塔
  2. 寻找极值点（相邻的26个点中最大/最小值）
  3. 去除不好的特征点：使用近似的harris corner，检测关键点的位置和尺度，并且去除边缘效应点
  4. 用$16\times16$放在特征点附近
  5. 将$16\times16$分成16个$4\times4$的窗口
  6. 计算窗口中每个像素的边的方向（梯度角减去90°）
  7. 丢掉方向能量小的边（使用阈值）用直方图描述结果
  8. 将每个小窗口的所有的方向离散成8个方向，一共$16\times8=128$



- **为什么不使用梯度信息**

  因为梯度信息可以表示边缘信息，并且在光照变化时由抵抗能力

- **不变性的解释**

  **平移不变：**SIFT是局部特征，只提取关键点附近矩形区域的sample，所以该物体移动到任何地方提取的feature都是类似的。同时因为是划grid去提取，即便关键点稍微偏离一些也是基本没有变化的。

  **旋转不变：**旋转的时候周围点也会一起旋转，不会影响SIFT向量(在计算grid的梯度bin前需要旋转主方向，因此有了一定的旋转不变性)

  **光照不变：**计算feature vector的时候进行了归一化、卡阈值之后再一次归一化，抵消了部分光照的影响。

  **尺度不变：**金字塔模型，对每一种尺度都能进行检测，所以具有尺度不变（通过前一步计算LoG得到的尺度来确定计算feature的范围，所以不同尺度都能得到类似的feature）

- **尺度不变的原理**

  见上





### Chapter5-Curve 曲线

#### Hough变换

- **解决什么问题**

  Hough变换是基于投票(Voting)原理的参数估计方法，是一种重要的形状检测技术  

  

- **基本思想**

  图像中每一点对参数组合进行表决，赢得多数票的参数组合为胜者（结果）。

  用极坐标来表示直线，从(x,y)转换到(p,0)空间。

- **具体原理**

- **基本步骤**

  - 适当地量化参数空间（合适的精度即可）  
  - 假定参数空间的每一个单元都是一个累加器，把累加器初始化为零  
  - 对图像空间的每一点，在其所满足的参数方程对应的累加器上加1  
  - 累加器阵列的最大值对应模型的参数  

- **直线检测**

  <img src=".\img\23.jpg" alt="23" style="zoom:50%;" />

  <img src=".\img\24.jpg" alt="24" style="zoom:50%;" />

  <img src=".\img\25.jpg" alt="25" style="zoom:50%;" />

  <img src=".\img\26.jpg" alt="26" style="zoom:50%;" />

- **圆弧检测6部曲**

  <img src=".\img\22.jpg" alt="22" style="zoom: 50%;" />

  <img src=".\img\21.jpg" alt="21" style="zoom: 50%;" />

---



### Chapter6-Eigenface 人脸识别

#### PCA主元分析

1. **基本思想和原理**

   用于数据集降维，选择一个新的坐标系统进行线性降维，使得第一轴上是最大投影方向，第二轴上是第二大投影方向……以此类推。

2. **什么样的数据用PCA会比较有效**

   多维数据

3. **优化目标函数的推导**

$$
d-维空间 \quad x=(x_1,x_2…,x_d)\\
投影方向 \quad a_1=(a_1^1,a_1^2,…,a_1^d)^T \quad where \ a_1^Ta_1=1 \\
投影值 \quad z_1=a_1^T=\sum_{i=1}^d a_1^ix^i
$$

​	需要最大化	$var(z_1)$

​	求投影方向	$argmax \ var(z_1)$

​	![27](.\img\27.jpg)

其中S代表协方差矩阵，要在限制条件$a_1^Ta_1=1$ 最大化	$var(z_1)$,应用拉格朗日乘法

![28](.\img\28.jpg)

经过计算，得到投影方向a是矩阵方向S最大特征根对应的特征向量。



#### Eigenface

1. **什么是Eigenface**

   使用特征脸进行人脸识别的方法

2. **Eigenface人脸识别方法的基本步骤**

   - 预处理：根据人眼位置进行剪裁，进行灰度均衡化
   - 将二维人脸图像按一行行向量排成一列，得到列图像；并把所有列图像拼起来，求出平均人脸
   - 图像的协方差矩阵
   - 求协方差矩阵的特征值，以及归一化的特征向量，即为特征人脸

   ![30](.\img\30.jpg)

3. **将重构用于人脸检测的原理**

   - 识别：将两张图像都投影到人脸空间，比较投影向量的欧氏距离
   - 重构：将图像投影到人脸空间，通过左乘特征人脸空间矩阵恢复

   <img src=".\img\29.jpg" alt="29" style="zoom:67%;" />

---



### Chapter7-Frequency 图像频域与图像分解

#### 从图像分解角度，理解傅里叶变换的意义

- 变换：用正弦来表示，对于二维图像而言，由以下的基图像表示：

<img src=".\img\31.jpg" alt="31" style="zoom:80%;" />

- 低频与高频：亮度灰度剧烈变化的地方是高频（图像边缘和轮廓的度量），对应边缘；变化不大的是低频（图像强度的综合度量），对应大片色块。近处看到的是高频分量，远处观察到的是低频分量。

- 对图像进行二维傅立叶变换得到频谱图，就是图像梯度的分布图。

  如果频谱图中暗的点数更多，那么实际图像是比较柔和的（因为各点与邻域差异都不大，梯度相对较小）；如果频谱图中亮的点数多，那么实际图像一定是尖锐的，边界分明且边界两边像素差异较大的。

- 提供了从另一个空间（频域）去理解图像的方式。频域可以更加直观地理解为梯度或者是功率。



#### 怎么理解拉普拉斯图像金字塔的每一层是带通滤波？

拉普拉斯金字塔是将图像下采样后再上采样得到的差值图像。

相减 保留细节 高通

下采样 降噪 低通

<img src=".\img\32.jpg" alt="32" style="zoom:67%;" />

---



### Chapter8-Image Stitching 图像拼接

#### RANSAC

1. **Generally speaking, 可以解决什么样的问题？**

   解决模型拟合的问题

2. **核心思想**

   - inliers（内群）数据可以通过几组模型的参数来叙述其分布，而outliers（离群）数据则是不适合模型化的数据
   - 数据会受到噪声的影响，噪声指的是离群，例如从极端的噪声或错误解释有关数据的测量或不正确的假设
   - RANSAC假定，给定一组（通常很小）的内存，存在一个程序，可以估算最适用于这一组数据模型的参数

3. **优缺点**

   - **优点：**是大范围模型匹配问题的一个普遍意义上的方法，且运用简单，计算快
   - **缺点：**只能计算outliers比例不高的情况（投票机制可以解决outliers高的情况）

4. **基本步骤**

   - 在数据中随机选择几个点设定为内群(hypothetical inliers)

   - 计算拟合内群的模型

   - 把刚才没选到的点带入刚才建立的模型中，计算是否为内群

     >根据一些模型特定的损失函数，符合估计模型的那些点被认为是内群的一部分

   - 记下内群数量

   - 重复以上步骤

   - 比较哪次计算中内群的数量最多，内群最多的那次所建的模型就是要求的解

5. **outlier点比例给定的情况下，则k次采样（迭代） 后计算成功的概率是**

$$
w:inlier点的比例\\
n:用于确定模型的样本个数\\
k:采样个数\\
概率: 1-(1-w^n)^k
$$



#### 图像拼接

1. **实现两张图像自动拼接的基本步骤**

   ![33](.\img\33.jpg)



---



### Chapter9&10- Visual Recognition&BoW 物体识别

#### Visual Recognition

1. **基本任务大概可以分为哪几大类**

   - 图片分类
   - 检测和定位物体/图片分割
   - 估计语义和几何属性
   - 对人类活动和事件进行分类

2. **都有哪些挑战**

   - 视角变换

   - 光线变化

   - 尺度变化

   - 物体遮挡

   - 背景凌乱

   - 内部类别多样

     

#### 基于词袋(BoW)的物体分类

1. **图像的BoW(bag-of-words)是指什么意思**

   图像中的单词被定义为一个图像块的特征向量，图像的BoW模型即图像中所有图像块的特征向量得到的直方图

   <img src=".\img\34.jpg" alt="34" style="zoom:67%;" />

2. **基本步骤**

   - 特征提取与表示
   - 通过训练样本聚类来建立字典
   - 用字典的直方图来表达一张图像
   - 根据bag-of-words来分类未知图像



---



### Chapter12-Motion(Optical flow) 移动(光流)

#### 光流解决的是什么问题

1. **定义:** optical flow is the apparent motion of brightness patterns in the image  

   apparent motion can be caused by lighting changes without any actual motion  

2. 评估从H到I的像素运动，给出图像H中的一个像素，找到图像I中相同颜色的相近像素。解决的是像素对应问题。

   <img src=".\img\35.jpg" alt="35" style="zoom:50%;" />

   

#### 光流的三个基本假设是什么

1. **空间相干性 spatial coherence**

   实际物体表面上不同两点在图片中具有一致的运动趋势.

   同一子图像的像素点具有相同的运动

2. **细微运动 small motion**

3. **亮度恒定性brightness constancy**

   相邻帧之间的亮度恒定

   $I(x+u,y+v,t+1)=I(x,y,t)$

   

#### 推导一个点的约束公式

$$
I(x+u,y+v) \approx I(x,y) + \frac{\partial I}{\partial x}u + \frac{\partial I}{\partial y}v\\
0 = I(x+u,y+v) - H(x,y)\\
\approx I(x,y) + I_xu + I_yv - H(x,y) \quad shorthand:I_x=\frac{\partial I}{\partial x}\\
\approx (I(x,y)-H(x,y)) + I_xu + I_yv\\
\approx I_t + I_xu + I_yv\\
\approx I_t + \nabla I ·[u\ v]
$$



#### 哪些位置光流比较可靠？为什么？

**纹理复杂区域**，因为梯度较大且方向不同，求出来的特征值比较大

#### 提高鲁棒性

![36](.\img\36.jpg)



---



### Chapter13-Camera 相机

#### 基本概念——理解景深/光圈/焦距/视场

1. **景深？视场？焦距？视场？**
   - 景深：相机镜头能够取得清晰图像的成像所测定的被摄物体前后范围距离  
   - 光圈：镜头中用于控制光线透过镜头并进入机身内感光面光量的装置  
   - 焦距：从镜片中心到底片等成像平面的距离  
   - 视场：镜头能够观察到的最大范围  

<img src=".\img\39.jpg" alt="39" style="zoom: 80%;" />

1. **光圈对景深的影响？理解原理**

   小光圈$\rightarrow$ 大景深，大光圈$\rightarrow$ 小景深

   <img src=".\img\38.jpg" alt="38" style="zoom: 80%;" />

2. **焦距对视场的影响？理解原理**

   短焦距$\rightarrow$ 大视场角:	 $\varphi = \arctan \frac{d}{2f}$

   <img src=".\img\37.jpg" alt="37" style="zoom: 67%;" />

   大焦距 离得近：整个场景被缩短，远处的东西被拉到近处而且很大，但是虚化了焦距内的物体也能看到

   小焦距 离得远：整个场景被拉长，远处的东西很小，但是都很清楚，焦距内的东西会在视野之外

   

#### 理想的针孔相机模型(pinhole camera)

1. **基本投影公式**

   **相机坐标系$\rightarrow$ 成像坐标系(3D TO 2D)  **

   ![41](.\img\41.jpg)

   根据相似三角形：
   $$
   (x',y',z') \rightarrow (-d\frac{x}{z},-d\frac{y}{z},-d)
   $$
   

2. **推导齐次坐标形式下的透视投影公式(矩阵形式)**

   z不是齐次的，那就转化成齐次的：

   <img src=".\img\42.jpg" alt="42" style="zoom:67%;" />

   ![、](.\img\40.jpg)

3. **齐次坐标表示的好处**

   齐次坐标缩放一个常量因子是不变的，齐次坐标升维后，使得之前的平移运算（矩阵加法）也变成了矩阵乘法，这样旋转平移缩放变换都只要进行矩阵乘法运算就可以了。

4. **相机模型有哪几个内参(不包括畸变参数)，会写内参矩阵**

   4个 $f_x,f_y和相机的焦距、像素大小有关;c_x,c_y是平移的距离，和相机成像平面的大小有关$

   **成像坐标系$\rightarrow$ 像素坐标系(2D TO 2D)**：考虑度量单位（mm pixel）的不同，以及两坐标系原点不同，将一个成像平面的坐标$(x,y)$在水平上缩放$\alpha$倍，在竖直方向上缩放$\beta$倍，同时平移$(c_x,c_y)$，就可以得到像素坐标系的坐标$(\mu,\upsilon)$
   $$
   \begin{cases}
   \mu = \alpha ·x + c_x \\
   \upsilon = \beta · y + c_y\\
   x = f \frac{X}{Z}\\
   y = f \frac{Y}{Z}
   \end{cases}
   $$
   得到
   $$
   \begin{cases}
   \mu = \alpha ·f \frac{X}{Z} + c_x \\
   \upsilon = \beta · f \frac{Y}{Z} + c_y\\
   其中f_x=\alpha·f, f_y = \beta·f
   \end{cases}
   $$
   写成齐次坐标系：

   ![43](.\img\43.jpg)

   ![44](.\img\44.jpg)

   

#### 畸变

1. **径向畸变与切向畸变各是什么原因引起的？**
   - 径向畸变：原因是光线在远离透镜中心的地方比靠近中心的地方更加弯曲
   - 切向畸变：原因是透镜不完全平行于图像平面
2. **径向畸变常见的有哪两种？**
   - 桶形畸变：中间向外凸起
   - 枕形畸变：中间向内凹陷



#### 外参矩阵

**世界坐标系$\rightarrow$ 相机坐标系(3D TO 3D)  **
$$
P_c = RP_w + t\\
$$
$P_c$是$P$在相机坐标系的坐标，$P_w$是其在世界坐标系下的坐标，可以使用旋转矩阵$R$(3x3)和一个平移向量$t$(3x1)将$P_c$转为$P_w$

<img src=".\img\45.jpg" alt="45"  />

![46](.\img\46.jpg)

<img src=".\img\48.jpg" alt="48" style="zoom:80%;" />

<img src=".\img\49.jpg" alt="49" style="zoom:67%;" />

#### 画图展示所有过程

<img src=".\img\47.jpg" alt="47" style="zoom:80%;" />

- 世界坐标系$\Rightarrow$ 相机坐标系：外参数

- 相机坐标系$\Rightarrow$ 图像坐标系$\Rightarrow$像平面坐标系(2D):内参数

- 非理想模型：

  像素$\Rightarrow$ 畸变参数

  - k和径向畸变有关
  - p和切向畸变有关

  畸变参数有五个 `k1,k2k3`为径向畸变系数，`p1,p2`是切向畸变系数

<img src=".\img\50.jpg" alt="50" style="zoom:67%;" />

---



#### Chapter14-Camera Calibration 相机定标

#### 一般的相机定标

1. **需要求解哪些参数**

   求解内外参(3D) 畸变参数(2D)

2. **解决这个问题的基本思路是什么**

   通过最小二乘法进行求解，类似解方程

   <img src=".\img\51.jpg" alt="51" style="zoom:80%;" />

#### 基于Homography的相机定标

1. **有哪些优点**

   - Only require the camera to observe a planar pattern shown at a few (minimum 2) different orientations
     ◦ Pattern can be printed and attached on planer surface
     ◦ Either camera or planar pattern can be moved by hand
   - More flexible and robust than traditional techniques
     ◦ Easy setup
     ◦ Anyone can make calibration pattern  
   - Considered flexibility, robustness, and low cost  

2. **已知什么，求解什么**

   - **已知**给定标定物体的N个角点，K个视角(棋盘格子两个点可以得出四个等式)
   - **求解**所有的参数。N个点K个视角可以列出2NK个等式，会带来6K+4个参数。需要2NK>=6K+4

3. **简述基本过程(4个步骤)**

   - 获取标定物体网格的角点在坐标系的位置
   - 找到图片的角点
   - 根据图像空间坐标系到世界坐标系建立等式
   - 求解相机参数

4. **Homography矩阵有几个自由度？求解需要至少几 个特征点？**

   8个自由度

   求解最少需要4个特征点





























